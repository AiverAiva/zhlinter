/**
 * 最終清理和修復，處理前面步驟可能遺漏的問題
 */
export function finalCleanup(text: string): string {
    return text
        // 專門處理括號後的句點問題
        .replace(/([^。！？])(\([^)]+\))\./g, "$1$2。")
        .replace(/([^。！？])(（[^）]+）)\./g, "$1$2。")
        // 處理混合括號情況
        .replace(/([^。！？])(（[^)]+\))\./g, "$1$2。")
        .replace(/([^。！？])(\([^）]+）)\./g, "$1$2。")
        // 確保句尾標點正確
        .replace(/\.$/g, "。")
        .replace(/([^。])\.\s*$/g, "$1。")
        // 最終引號檢查
        .replace(/「([^」]*)』/g, '「$1」')
        .replace(/『([^』]*)」/g, '『$1』')
        // 最終符號檢查
        .replace(/--/g, '──')          // 確保破折號正確
        .replace(/\.{3,}/g, '⋯⋯')      // 確保刪節號正確
        // 清理行內多餘空格
        .replace(/[ \t]+/g, " ")
        .trim();
}